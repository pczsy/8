<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='ç”µè„‘,ç”µè„‘è®²è§£,ç”µè„‘æŠ€æœ¯,ç¼–ç¨‹,ç”µè„‘æ•…éšœç»´ä¿®[æƒé™ç®¡ç†ç³»ç»Ÿç¯‡] (äº”)-Spring securityï¼ˆæˆæƒè¿‡ç¨‹åˆ†æï¼‰' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>é¦–é¡µ</a></li>
</div><div onclick='hidden1()' >åˆ†äº«</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>[æƒé™ç®¡ç†ç³»ç»Ÿç¯‡] (äº”)-Spring securityï¼ˆæˆæƒè¿‡ç¨‹åˆ†æï¼‰</center></div><div class='banquan'>åŸæ–‡å‡ºå¤„:æœ¬æ–‡ç”±åšå®¢å›­åšä¸»Ccwwç¬”è®°æä¾›ã€‚<br/>
åŸæ–‡è¿æ¥:https://www.cnblogs.com/Ccwwlx/p/12066939.html</div><br>
    <h1 class="md-end-block md-heading">&nbsp;</h1>
<blockquote>
<p><span class="md-plain">æ¬¢è¿å…³æ³¨å…¬ä¼—å·ã€<strong>Ccwwç¬”è®°</strong><span class="md-plain">ã€‘ï¼ŒåŸåˆ›æŠ€æœ¯æ–‡ç« ç¬¬ä¸€æ—¶é—´æ¨å‡º</span></span></p>
</blockquote>
<h1 class="md-end-block md-heading"><span class="md-plain">å‰è¨€</span></h1>
<p class="md-end-block md-p"><span class="md-plain">æƒé™ç®¡ç†ç³»ç»Ÿçš„ç»„ä»¶åˆ†æä»¥åŠè®¤è¯è¿‡ç¨‹çš„å¾€æœŸæ–‡ç« ï¼š</span></p>
<ul class="ul-list" data-mark="+">
<li class="md-list-item">
<p class="md-end-block md-p"><span class=" md-link"><a href="https://www.cnblogs.com/Ccwwlx/p/11970392.html"><span class="md-plain">Spring security ï¼ˆä¸€ï¼‰æ¶æ„æ¡†æ¶-Componentã€Serviceã€Filteråˆ†æ</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class=" md-link"><a href="https://www.cnblogs.com/Ccwwlx/p/11978429.html"><span class="md-plain">Spring Securityï¼ˆäºŒï¼‰--WebSecurityConfigureré…ç½®ä»¥åŠfilteré¡ºåº</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class=" md-link"><a href="https://www.cnblogs.com/Ccwwlx/p/12033546.html"><span class="md-plain">ã€æƒé™ç®¡ç†ç³»ç»Ÿã€‘Spring securityï¼ˆä¸‰ï¼‰---è®¤è¯è¿‡ç¨‹ï¼ˆåŸç†è§£æï¼Œdemoï¼‰</span></a></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">[<span class="md-link"><a href="https://www.cnblogs.com/Ccwwlx/p/12054169.html"><span class="md-plain">æƒé™ç®¡ç†ç³»ç»Ÿ(å››)<span>]<span class="md-plain">-spring boot +spring securityçŸ­ä¿¡è®¤è¯+redisæ•´åˆ</span></span></span></a></span></span></p>
</li>
</ul>
<h2 class="md-end-block md-heading"><span class="md-plain">1. æƒé™ç®¡ç†ç›¸å…³æ¦‚å¿µ</span></h2>
<p class="md-end-block md-p md-focus"><span class="md-entity" data-content="&emsp;">&emsp;<span class="md-entity" data-content="&emsp;">&emsp;<span class="md-plain">æƒé™ç®¡ç†æ˜¯ä¸€ä¸ªå‡ ä¹æ‰€æœ‰åå°ç³»ç»Ÿçš„éƒ½ä¼šæ¶‰åŠçš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä¸»è¦ç›®çš„æ˜¯å¯¹æ•´ä¸ªåå°ç®¡ç†ç³»ç»Ÿè¿›è¡Œæƒé™çš„æ§åˆ¶ã€‚å¸¸è§çš„åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œå…¶æˆæƒæ¨¡å‹ä¸º&ldquo;<span><strong>ç”¨æˆ·-è§’è‰²-æƒé™</strong><span class="md-plain md-expand">&rdquo;ï¼Œç®€æ˜çš„è¯´ï¼Œä¸€ä¸ªç”¨æˆ·æ‹¥æœ‰å¤šä¸ªè§’è‰²ï¼Œä¸€ä¸ªè§’è‰²æ‹¥æœ‰å¤šä¸ªæƒé™ã€‚å…¶ä¸­ï¼Œ</span></span></span></span></span></p>
<ul class="ul-list" data-mark="+">
<li class="md-list-item">
<p class="md-end-block md-p"><span><strong>ç”¨æˆ·ï¼š</strong><span class="md-plain"> ä¸ç”¨å¤šè®²ï¼Œå¤§å®¶ä¹ŸçŸ¥é“äº†ï¼› </span></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span><strong>è§’è‰²ï¼š</strong><span class="md-plain"> ä¸€ä¸ªé›†åˆçš„æ¦‚å¿µï¼Œè§’è‰²ç®¡ç†æ˜¯ç¡®å®šè§’è‰²å…·å¤‡å“ªäº›æƒé™çš„ä¸€ä¸ªè¿‡ç¨‹ ï¼›</span></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span><strong>æƒé™ï¼š</strong><span class="md-softbreak"> <span class="md-plain">1ï¼‰.é¡µé¢æƒé™ï¼Œæ§åˆ¶ä½ å¯ä»¥çœ‹åˆ°å“ªä¸ªé¡µé¢ï¼Œçœ‹ä¸åˆ°å“ªä¸ªé¡µé¢ï¼›<span class="md-linebreak"> <span class="md-linebreak-mark"> <span class="md-entity" data-content="&emsp;">&emsp;<span class="md-entity" data-content="&emsp;">&emsp;<span class="md-entity" data-content="&emsp;">&emsp;<span class="md-plain"> 2ï¼‰. æ“ä½œæƒé™ï¼Œæ§åˆ¶ä½ å¯ä»¥åœ¨é¡µé¢ä¸Šè¿›è¡Œå“ªäº›æ“ä½œï¼ˆæŸ¥è¯¢ã€åˆ é™¤ã€ç¼–è¾‘ç­‰ï¼‰ï¼›<span class="md-linebreak"> <span class="md-linebreak-mark"> <span class="md-entity" data-content="&emsp;">&emsp;<span class="md-entity" data-content="&emsp;">&emsp;<span class="md-entity" data-content="&emsp;">&emsp;<span class="md-plain"> 3ï¼‰.æ•°æ®æƒé™ï¼Œæ˜¯æ§åˆ¶ä½ å¯ä»¥çœ‹åˆ°å“ªäº›æ•°æ®ã€‚</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
</li>
</ul>
<p class="md-end-block md-p"><span><strong>å®è´¨æ˜¯ï¼š</strong><span class="md-plain"><span class="md-linebreak"> <span class="md-linebreak-mark"> <span class="md-entity" data-content="&emsp;">&emsp;</span></span></span></span></span></p>
<p class="md-end-block md-p"><span><span class="md-plain"><span class="md-linebreak"><span class="md-linebreak-mark"><span class="md-entity" data-content="&emsp;"><span class="md-plain">ã€€ã€€æƒé™ï¼ˆPermissionï¼‰ = èµ„æºï¼ˆResourceï¼‰ + æ“ä½œï¼ˆPrivilegeï¼‰<span class="md-linebreak"> <span class="md-linebreak-mark"> <span class="md-entity" data-content="&emsp;">&emsp;</span></span></span></span></span></span></span></span></span></p>
<p class="md-end-block md-p"><span><span class="md-plain"><span class="md-linebreak"><span class="md-linebreak-mark"><span class="md-entity" data-content="&emsp;"><span class="md-plain"><span class="md-linebreak"><span class="md-linebreak-mark"><span class="md-entity" data-content="&emsp;"><span class="md-plain">ã€€ã€€è§’è‰²ï¼ˆRoleï¼‰ = æƒé™çš„é›†åˆï¼ˆa set of low-level permissionsï¼‰<span class="md-linebreak"> <span class="md-linebreak-mark"> <span class="md-entity" data-content="&emsp;">&emsp;</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p class="md-end-block md-p"><span><span class="md-plain"><span class="md-linebreak"><span class="md-linebreak-mark"><span class="md-entity" data-content="&emsp;"><span class="md-plain"><span class="md-linebreak"><span class="md-linebreak-mark"><span class="md-entity" data-content="&emsp;"><span class="md-plain"><span class="md-linebreak"><span class="md-linebreak-mark"><span class="md-entity" data-content="&emsp;">ã€€ã€€<span class="md-plain">ç”¨æˆ·ï¼ˆUserï¼‰ = è§’è‰²çš„é›†åˆï¼ˆhigh-level rolesï¼‰</span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p class="md-end-block md-p"><span><strong>æƒé™ç®¡ç†è¿‡ç¨‹ï¼š</strong></span></p>
<ol class="ol-list" start="">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">é‰´æƒç®¡ç†ï¼Œå³æƒé™åˆ¤æ–­é€»è¾‘ï¼Œå¦‚èœå•ç®¡ç†ï¼ˆæ™®é€šä¸šåŠ¡äººå‘˜ç™»å½•ç³»ç»Ÿåï¼Œæ˜¯çœ‹ä¸åˆ°ã€ç”¨æˆ·ç®¡ç†ã€‘èœå•çš„ï¼‰ã€åŠŸèƒ½æƒé™ç®¡ç†ï¼ˆURLè®¿é—®çš„ç®¡ç†ï¼‰ã€è¡Œçº§æƒé™ç®¡ç†ç­‰</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">æˆæƒç®¡ç†ï¼Œå³æƒé™åˆ†é…è¿‡ç¨‹ï¼Œå¦‚ç›´æ¥å¯¹ç”¨æˆ·æˆæƒï¼Œç›´æ¥åˆ†é…åˆ°ç”¨æˆ·çš„æƒé™å…·æœ‰æœ€ä¼˜å…ˆçº§åˆ«ã€å¯¹ç”¨æˆ·æ‰€å±å²—ä½æˆæƒï¼Œç”¨æˆ·æ‰€å±å²—ä½ä¿¡æ¯å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªåˆ†ç»„ï¼Œå’Œè§’è‰²çš„ä½œç”¨ä¸€æ ·ï¼Œä½†æ˜¯æ¯ä¸ªç”¨æˆ·åªèƒ½å…³è”ä¸€ä¸ªå²—ä½ä¿¡æ¯ç­‰ã€‚ </span></p>
</li>
</ol>
<p class="md-end-block md-p"><span class="md-entity" data-content="&emsp;">&emsp;<span class="md-entity" data-content="&emsp;">&emsp;<span class="md-plain">åœ¨å®é™…é¡¹ç›®ä¸­ç”¨æˆ·æ•°é‡å¤šï¼Œé€ä¸€çš„ä¸ºæ¯ä¸ªç³»ç»Ÿç”¨æˆ·æˆæƒï¼Œè¿™æ˜¯æå…¶ç¹ççš„äº‹ï¼Œæ‰€ä»¥å¯ä»¥å­¦ä¹ linuxæ–‡ä»¶ç®¡ç†ç³»ç»Ÿä¸€æ ·ï¼Œè®¾ç½®groupæ¨¡å¼ï¼Œä¸€ç»„æœ‰å¤šä¸ªç”¨æˆ·ï¼Œå¯ä»¥ä¸ºç”¨æˆ·ç»„æˆæƒç›¸åŒçš„æƒé™ï¼Œç®€ä¾¿å¤šäº†ã€‚è¿™æ ·æ¨¡å¼ä¸‹ï¼š<span class="md-linebreak"> <span class="md-linebreak-mark"> <span class="md-entity" data-content="&emsp;">&emsp;<span class="md-entity" data-content="&emsp;">&emsp;<span><strong>æ¯ä¸ªç”¨æˆ·çš„æ‰€æœ‰æƒé™=ç”¨æˆ·ä¸ªäººçš„æƒé™+ç”¨æˆ·ç»„æ‰€ç”¨çš„æƒé™</strong><span class="md-plain"><span class="md-linebreak"> <span class="md-linebreak-mark"> <span class="md-plain">ç”¨æˆ·ç»„ã€ç”¨æˆ·ã€ä¸è§’è‰²ä¸‰è€…å…³ç³»å¦‚ä¸‹ï¼š</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="./images/[æƒé™ç®¡ç†ç³»ç»Ÿç¯‡] (äº”)-Spring securityï¼ˆæˆæƒè¿‡ç¨‹åˆ†æï¼‰0.png"><img src="./images/[æƒé™ç®¡ç†ç³»ç»Ÿç¯‡] (äº”)-Spring securityï¼ˆæˆæƒè¿‡ç¨‹åˆ†æï¼‰0.png" alt="" /></span></p>
<p class="md-end-block md-p"><span class="md-plain">å†ç»“åˆæƒé™ç®¡ç†çš„é¡µé¢æƒé™ã€æ“ä½œæƒé™ï¼Œå¦‚èœå•çš„è®¿é—®ã€åŠŸèƒ½æ¨¡å—çš„æ“ä½œã€æŒ‰é’®çš„æ“ä½œç­‰ç­‰ï¼Œå¯æŠŠåŠŸèƒ½æ“ä½œä¸èµ„æºç»Ÿä¸€ç®¡ç†ï¼Œå³è®©å®ƒä»¬ç›´æ¥ä¸æƒé™å…³è”èµ·æ¥ï¼Œå…³ç³»å›¾å¦‚ä¸‹ï¼š<span class="md-softbreak"> <span class="md-image md-img-loaded" data-src="./images/[æƒé™ç®¡ç†ç³»ç»Ÿç¯‡] (äº”)-Spring securityï¼ˆæˆæƒè¿‡ç¨‹åˆ†æï¼‰1.png"><img src="./images/[æƒé™ç®¡ç†ç³»ç»Ÿç¯‡] (äº”)-Spring securityï¼ˆæˆæƒè¿‡ç¨‹åˆ†æï¼‰1.png" alt="" /></span></span></span></p>
<h2 class="md-end-block md-heading"><span class="md-plain">2. æˆæƒè¿‡ç¨‹åˆ†æ</span></h2>
<p class="md-end-block md-p">&nbsp;</p>
<h3 class="md-end-block md-heading"><span class="md-plain">2.1 æˆæƒè®¿é—®æƒé™å·¥ä½œæµç¨‹ï¼š</span>&nbsp; &nbsp;&nbsp;</h3>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">  FilterSecurityInterceptor
                             doFilter()</span>-&gt;<span style="color: #000000;">invoke()
                               </span>-&gt;<span style="color: #000000;">AbstractSecurityInterceptor
                                   beforeInvocation()
                           </span>-&gt;<span style="color: #000000;">SecurityMetadataSource è·å–ConfigAttributeå±æ€§ä¿¡æ¯ï¼ˆä»æ•°æ®åº“æˆ–è€…å…¶ä»–æ•°æ®æºåœ°æ–¹ï¼‰
                                       getAttributes()
                                   </span>-&gt;<span style="color: #000000;">AccessDecisionManager()  åŸºäºAccessDecisionVoterå®ç°æˆæƒè®¿é—®
                                           Decide()
                                       </span>-&gt;<span style="color: #000000;">AccessDecisionVoter  å—AccessDecisionManagerå§”æ‰˜å®ç°æˆæƒè®¿é—®
                                               vote()</span></pre>
</div>
<p class="md-end-block md-p"><span class="md-plain"> é»˜è®¤æˆæƒè¿‡ç¨‹ä¼šä½¿ç”¨è¿™æ ·çš„å·¥ä½œæµç¨‹ï¼Œæ¥ä¸‹æ¥æ¥åˆ†æå„ä¸ªç»„ä»¶çš„åŠŸèƒ½ä¸æºç ã€‚</span></p>
<h3 class="md-end-block md-heading"><span class="md-plain">2.2 AbstractSecurityInterceptoråˆ†æ</span></h3>
<p class="md-end-block md-p"><span class="md-entity" data-content="&emsp;">&emsp;<span class="md-entity" data-content="&emsp;">&emsp;<span><strong>FilterSecurityInterceptor</strong><span class="md-plain">ä¸ºæˆæƒæ‹¦æˆªå™¨ï¼Œ åœ¨<span><strong>FilterSecurityInterceptor</strong><span class="md-plain">ä¸­æœ‰ä¸€ä¸ªå°è£…äº†<span><strong>è¿‡æ»¤é“¾</strong><span class="md-plain">ã€<span><strong>request</strong><span class="md-plain">ä»¥åŠ<span><strong>response</strong><span class="md-plain">çš„<span><strong>FilterInvocation</strong><span class="md-plain">å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œåœ¨<span><strong>FilterSecurityInterceptor</strong><span class="md-plain">ï¼Œä¸»è¦ç”±<span><strong>invoke()</strong><span class="md-plain">è°ƒç”¨å…¶çˆ¶ç±»<span><strong>AbstractSecurityInterceptor</strong><span class="md-plain">çš„æ–¹æ³•ã€‚ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p class="md-end-block md-p"><span class="md-plain">invoke()åˆ†æï¼š</span></p>
<div class="cnblogs_code">
<pre><code> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> invoke(FilterInvocation fi) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> IOException, ServletException {
                 .....
                 </span><span style="color: #008000;">//</span><span style="color: #008000;"> è·å–accessDecisionManageræƒé™å†³ç­–åç»“æœçŠ¶æ€ã€ä»¥åŠæƒé™å±æ€§</span>
        InterceptorStatusToken token = <span style="color: #0000ff;">super</span><span style="color: #000000;">.beforeInvocation(fi);
â€‹
        </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
            fi.getChain().doFilter(fi.getRequest(), fi.getResponse());
        }
        </span><span style="color: #0000ff;">finally</span><span style="color: #000000;"> {
            </span><span style="color: #0000ff;">super</span><span style="color: #000000;">.finallyInvocation(token);
        }
â€‹
        </span><span style="color: #0000ff;">super</span>.afterInvocation(token, <span style="color: #0000ff;">null</span><span style="color: #000000;">);
    }
}</span></pre>
</div>
<p class="md-end-block md-p"><span class="md-plain"> <span class="md-entity" data-content="&emsp;">&emsp;<span class="md-entity" data-content="&emsp;">&emsp;<span><strong>AbstractSecurityInterceptor</strong><span class="md-plain"> çš„æˆæƒè¿‡æ»¤å™¨ä¸»è¦æ–¹æ³•<span><strong>beforeInvocation()</strong><span class="md-plain">,<span><strong>afterInvocation()</strong><span class="md-plain">ä»¥åŠ<span><strong>authenticateIfRequired()</strong><span class="md-plain">,å…¶æœ€ä¸»è¦çš„æ–¹æ³•<span><strong>beforeInvocation()</strong><span class="md-plain"> åˆ†æå¦‚ä¸‹ï¼š</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">protected</span><span style="color: #000000;"> InterceptorStatusToken beforeInvocation(Object object) {
       ....
       </span><span style="color: #008000;">//</span><span style="color: #008000;">ä»SecurityMetadataSourceçš„æƒé™å±æ€§</span>
    Collection&lt;ConfigAttribute&gt; attributes = <span style="color: #0000ff;">this</span><span style="color: #000000;">.obtainSecurityMetadataSource()
            .getAttributes(object);
    </span><span style="color: #0000ff;">if</span> (attributes == <span style="color: #0000ff;">null</span> ||<span style="color: #000000;"> attributes.isEmpty()) {
             .....
        publishEvent(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> PublicInvocationEvent(object));
        </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span>; <span style="color: #008000;">//</span><span style="color: #008000;"> no further work post-invocation</span>
<span style="color: #000000;">    }
â€‹
    </span><span style="color: #008000;">//</span><span style="color: #008000;">è°ƒç”¨è®¤è¯ç¯èŠ‚è·å–authenticatedï¼ˆåŒ…å«ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼‰</span>
    Authentication authenticated =<span style="color: #000000;"> authenticateIfRequired();
â€‹
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> Attempt authorization</span>
    <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
        </span><span style="color: #008000;">//</span><span style="color: #008000;">è¿›è¡Œå…³é”®çš„ä¸€æ­¥ï¼šæˆæƒçš„æœ€ç»ˆå†³ç­–  </span>
        <span style="color: #0000ff;">this</span><span style="color: #000000;">.accessDecisionManager.decide(authenticated, object, attributes);
    }
    </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (AccessDeniedException accessDeniedException) {
        publishEvent(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> AuthorizationFailureEvent(object, attributes, authenticated,
                accessDeniedException));
â€‹
        </span><span style="color: #0000ff;">throw</span><span style="color: #000000;"> accessDeniedException;
    }
 

    </span><span style="color: #008000;">//</span><span style="color: #008000;"> Attempt to run as a different user</span>
    Authentication runAs = <span style="color: #0000ff;">this</span><span style="color: #000000;">.runAsManager.buildRunAs(authenticated, object,
            attributes);
â€‹
    </span><span style="color: #0000ff;">if</span> (runAs == <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (debug) {
            logger.debug(</span>"RunAsManager did not change Authentication object"<span style="color: #000000;">);
        }
â€‹
        </span><span style="color: #008000;">//</span><span style="color: #008000;"> no further work post-invocation</span>
        <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span> InterceptorStatusToken(SecurityContextHolder.getContext(), <span style="color: #0000ff;">false</span><span style="color: #000000;">,
                attributes, object);
    }
    </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (debug) {
            logger.debug(</span>"Switching to RunAs Authentication: " +<span style="color: #000000;"> runAs);
        }
â€‹
        SecurityContext origCtx </span>=<span style="color: #000000;"> SecurityContextHolder.getContext();
        SecurityContextHolder.setContext(SecurityContextHolder.createEmptyContext());
        SecurityContextHolder.getContext().setAuthentication(runAs);
â€‹
        </span><span style="color: #008000;">//</span><span style="color: #008000;"> need to revert to token.Authenticated post-invocation </span>
        <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span> InterceptorStatusToken(origCtx, <span style="color: #0000ff;">true</span><span style="color: #000000;">, attributes, object);
    }
}</span></pre>
</div>
<h3 class="md-end-block md-heading"><span class="md-plain">2.3 SecurityMetadataSource</span></h3>
<p class="md-end-block md-p"><span class="md-plain"> <span class="md-entity" data-content="&emsp;">&emsp;<span class="md-entity" data-content="&emsp;">&emsp;<span><strong>SecurityMetadataSource</strong><span class="md-plain">æ˜¯ä»æ•°æ®åº“æˆ–è€…å…¶ä»–æ•°æ®æºä¸­åŠ è½½<span><strong>ConfigAttribute</strong><span class="md-plain">ï¼Œä¸ºäº†åœ¨<span><strong>AccessDecisionManager.decide()</strong><span class="md-plain"> æœ€ç»ˆå†³ç­–ä¸­è¿›è¡Œmatchã€‚å…¶æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š</span></span></span></span></span></span></span></span></span></p>
<div class="cnblogs_code">
<pre><code>Collection&lt;ConfigAttribute&gt; getAttributes(Object var1) <span style="color: #0000ff;">throws</span> IllegalArgumentException;<span style="color: #008000;">//</span><span style="color: #008000;">åŠ è½½æƒé™èµ„æº</span>
<span style="color: #000000;">â€‹
Collection</span>&lt;ConfigAttribute&gt; getAllConfigAttributes();<span style="color: #008000;">//</span><span style="color: #008000;">åŠ è½½æ‰€æœ‰æƒé™èµ„æº</span>
<span style="color: #000000;">â€‹
</span><span style="color: #0000ff;">boolean</span> supports(Class&lt;?&gt; var1);</pre>
</div>
<h3 class="md-end-block md-heading"><span class="md-plain">2.4 AccessDecisionManager</span></h3>
<p class="md-end-block md-p"><span class="md-entity" data-content="&emsp;">&emsp;<span class="md-entity" data-content="&emsp;">&emsp;<span><strong>AccessDecisionManager</strong><span class="md-plain">è¢«<span><strong>AbstractSecurityInterceptor</strong><span class="md-plain"> æ‹¦æˆªå™¨è°ƒç”¨è¿›è¡Œæœ€ç»ˆè®¿é—®æ§åˆ¶å†³ç­–ã€‚<span class="md-softbreak"> <span class="md-plain"> è€Œä¸”ç”±<span><strong>AuthenticationManager</strong><span class="md-plain">åˆ›å»ºçš„Authentication objectä¸­çš„GrantedAuthorityï¼Œé¦–å…ˆè¢«æˆæƒæ¨¡å—ä¸­çš„ <span><strong>AccessDecisionManager</strong><span class="md-plain">è¯»å–ä½¿ç”¨ï¼Œå½“å¤æ‚çš„GrantedAuthorityï¼ŒgetAuthorityï¼ˆï¼‰ä¸ºnullï¼Œå› æ­¤éœ€è¦<span><strong>AccessDecisionManager</strong><span class="md-plain">ä¸“é—¨æ”¯æŒ<span><strong>GrantedAuthority</strong><span class="md-plain">å®ç°ä»¥ä¾¿äº†è§£å…¶å†…å®¹ã€‚</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p class="md-end-block md-p"><span class="md-plain"> <span><strong>AccessDecisionManager</strong><span class="md-plain">æ¥å£æ–¹æ³•ï¼š</span></span></span>&nbsp;&nbsp;</p>
<div class="cnblogs_code">
<pre><code> <span style="color: #0000ff;">void</span> decide(Authentication authentication, Object secureObject,    Collection&lt;ConfigAttribute&gt; attrs) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> AccessDeniedException;
â€‹
   </span><span style="color: #0000ff;">boolean</span><span style="color: #000000;"> supports(ConfigAttribute attribute);
â€‹
   </span><span style="color: #0000ff;">boolean</span> supports(Class clazz);</pre>
</div>
<h3 class="md-end-block md-heading"><span class="md-plain">2.5 AccessDecisionVoter</span></h3>
<p class="md-end-block md-p"><span class="md-entity" data-content="&emsp;">&emsp;<span class="md-entity" data-content="&emsp;">&emsp;<span class="md-plain">AccessDecisionManager.decide()å°†ä½¿ç”¨<span><strong>AccessDecisionVoter</strong><span class="md-plain">è¿›è¡ŒæŠ•ç¥¨å†³ç­–ã€‚<span><strong>AccessDecisionVoter</strong><span class="md-plain">è¿›è¡ŒæŠ•ç¥¨è®¿é—®æ§åˆ¶å†³ç­–ï¼Œè®¿é—®ä¸é€šè¿‡å°±æŠ›å‡º<span><strong>AccessDeniedException</strong><span class="md-plain">ã€‚</span></span></span></span></span></span></span></span></span></p>
<p class="md-end-block md-p"><span class="md-plain">&nbsp;AccessDecisionVoteræ¥å£æ–¹æ³•ï¼š</span></p>
<div class="cnblogs_code">
<pre><code> <span style="color: #0000ff;">int</span> vote(Authentication authentication, Object object, Collection&lt;ConfigAttribute&gt;<span style="color: #000000;"> attrs);
â€‹
   </span><span style="color: #0000ff;">boolean</span><span style="color: #000000;"> supports(ConfigAttribute attribute);
â€‹
   </span><span style="color: #0000ff;">boolean</span> supports(Class clazz);</pre>
</div>
<p class="md-end-block md-p"><span class="md-plain"> <span><strong>AccessDecisionVoter</strong><span class="md-plain">çš„<span><strong>æ ¸å¿ƒæ–¹æ³•vote()</strong><span class="md-plain"> é€šå¸¸æ˜¯è·å–<span><strong>Authenticationçš„GrantedAuthority</strong><span class="md-plain">ä¸<span><strong>å·²å®šä¹‰å¥½çš„ConfigAttributes</strong><span class="md-plain">è¿›è¡Œ<span><strong>match</strong><span class="md-plain">ï¼Œå¦‚æœæˆåŠŸä¸ºæŠ•åŒæ„ç¥¨ï¼ŒåŒ¹é…ä¸æˆåŠŸä¸ºæ‹’ç»ç¥¨ï¼Œå½“ConfigAttributesä¸­æ— å±æ€§æ—¶ï¼Œæ‰æŠ•å¼ƒç¥¨ã€‚</span></span></span></span></span></span></span></span></span></span></span></p>
<p class="md-end-block md-p">&nbsp;</p>
<p class="md-end-block md-p"><span class="md-plain"> Spring Securityæä¾›äº†ä¸‰ç§æŠ•ç¥¨æ–¹å¼å»å®ç°<span><strong>AccessDecisionManager</strong><span class="md-plain">æ¥å£è¿›è¡ŒæŠ•ç¥¨è®¿é—®æ§åˆ¶å†³ç­–ï¼š</span></span></span></p>
<ul class="ul-list" data-mark="+">
<li class="md-list-item">
<p class="md-end-block md-p"><span><strong>ConsensusBasedï¼š</strong><span class="md-plain"> å¤§å¤šæ•°voteråŒæ„è®¿é—®å°±æˆæƒè®¿é—®</span></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span><strong>AffirmativeBasedï¼š</strong><span class="md-plain"> åªè¦ä¸€ä¸ªä»¥ä¸ŠvoteråŒæ„è®¿é—®å°±æˆæƒè®¿é—®ï¼Œå…¨éƒ¨</span></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span><strong>UnanimousBased ï¼š</strong><span class="md-plain"> åªæœ‰å…¨ä½“åŒæ„äº†æ‰æˆæƒè®¿é—®</span></span></p>
</li>
</ul>
<p class="md-end-block md-p"><span class="md-plain"> ä¸”<span><strong>AccessDecisionVoter</strong><span class="md-plain">ç”¨ä¸‰ä¸ªé™æ€å˜é‡è¡¨ç¤ºvoteræŠ•ç¥¨æƒ…å†µï¼š</span></span></span></p>
<ul class="ul-list" data-mark="+">
<li class="md-list-item">
<p class="md-end-block md-p"><span><strong>ACCESS_ABSTAINï¼š</strong><span class="md-plain"> å¼ƒæƒ</span></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span><strong>ACCESS_DENIEDï¼š</strong><span class="md-plain"> æ‹’ç»è®¿é—®</span></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span><strong>ACCESS_GRANTEDï¼š</strong><span class="md-plain"> å…è®¸è®¿é—®</span></span></p>
</li>
</ul>
<p class="md-end-block md-p"><span class="md-plain"> <span><strong>Noteï¼š</strong><span class="md-plain"> <span><strong>å½“æ‰€æœ‰voteréƒ½å¼ƒæƒæ—¶ä½¿ç”¨å˜é‡allowIfEqualGrantedDeniedDecisionsæ¥åˆ¤æ–­ï¼Œtrueä¸ºé€šè¿‡ï¼ŒfalseæŠ›å‡ºAccessDeniedExceptionã€‚</strong></span></span></span></span></p>
<p class="md-end-block md-p"><span class="md-plain"> æ­¤å¤–å¯è‡ªå®šä¹‰<span><strong>AccessDecisionManager</strong><span class="md-plain">å®ç°æ¥å£ï¼Œå› ä¸ºå¯èƒ½æŸäº›AccessDecisionVoterå…·æœ‰æƒé‡æ¯”é«˜æŠ•ç¥¨æƒæˆ–è€…æŸäº›AccessDecisionVoterå…·æœ‰ä¸€ç¥¨å¦å®šæƒã€‚AccessDecisionVoterçš„Spring securityå®ç°ç±»<span><strong>RoleVoter</strong><span class="md-plain">å’Œ<span><strong>AuthenticatedVoter</strong><span class="md-plain">ã€‚<span><strong>RoleVoterä¸ºæœ€ä¸ºå¸¸è§çš„AccessDecisionVoterï¼Œå…¶ä¸ºç®€å•çš„æƒé™è¡¨ç¤ºï¼Œå¹¶ä»¥å‰ç¼€ä¸ºROLE_ï¼ŒvoteåŒ¹é…è§„åˆ™ä¹Ÿè·Ÿä¸Šé¢ä¸€æ ·ã€‚</strong></span></span></span></span></span></span></span></span></p>
<p class="md-end-block md-p"><span class="md-plain"> æºç åˆ†æï¼š</span></p>
<div class="cnblogs_code">
<pre><code>Public <span style="color: #0000ff;">int</span> vote(Authentication authentication,Object object,Collection&lt;ConfigAttribute&gt;<span style="color: #000000;">attributes){
    </span><span style="color: #008000;">//</span><span style="color: #008000;">ç”¨æˆ·ä¼ é€’çš„authenticationä¸ºnullï¼Œæ‹’ç»è®¿é—®</span>
   <span style="color: #0000ff;">if</span>(authentication==<span style="color: #0000ff;">null</span><span style="color: #000000;">){
â€‹
       </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> ACCESS_DENIED;
â€‹
   }
â€‹
   </span><span style="color: #0000ff;">int</span> result=<span style="color: #000000;">ACCESS_ABSTAIN;
â€‹
   Collection</span>&lt;?extendsGrantedAuthority&gt;authorities=<span style="color: #000000;">extractAuthorities(authentication);
 

    </span><span style="color: #008000;">//</span><span style="color: #008000;">ä¾æ¬¡è¿›è¡ŒæŠ•ç¥¨</span>
   <span style="color: #0000ff;">for</span><span style="color: #000000;">(ConfigAttributeattribute:attributes){
 

       </span><span style="color: #0000ff;">if</span>(<span style="color: #0000ff;">this</span><span style="color: #000000;">.supports(attribute)){
â€‹
           result</span>=<span style="color: #000000;">ACCESS_DENIED;
â€‹
           </span><span style="color: #008000;">//</span><span style="color: #008000;">Attempt to find a matching granted authority</span>
<span style="color: #000000;">â€‹
           </span><span style="color: #0000ff;">for</span><span style="color: #000000;">(GrantedAuthorityauthority:authorities){
â€‹
           </span><span style="color: #0000ff;">if</span><span style="color: #000000;">(attribute.getAttribute().equals(authority.getAuthority())){
â€‹
           returnACCESS_GRANTED;
           }
      }
   }
 }</span></pre>
</div>
<h2 class="md-end-block md-heading"><span class="md-plain">3. æ¡ˆä¾‹-è‡ªå®šä¹‰ç»„ä»¶</span></h2>
<p class="md-end-block md-p"><span class="md-plain"> <span><strong>è‡ªå®šä¹‰ç»„ä»¶ï¼š</strong></span></span></p>
<ol class="ol-list" start="">
<li class="md-list-item">
<p class="md-end-block md-p"><span><strong>è‡ªå®šä¹‰FilterSecurityInterceptor</strong><span class="md-plain">ï¼Œå¯ä»¿å†™<span><strong>FilterSecurityInterceptor</strong><span class="md-plain">ï¼Œå®ç°æŠ½è±¡ç±»<span><strong>AbstractSecurityInterceptor</strong><span class="md-plain">ä»¥åŠ<span><strong>Filter</strong><span class="md-plain">æ¥å£ï¼Œå…¶ä¸»è¦çš„æ˜¯æŠŠ<span><strong>è‡ªå®šä¹‰çš„SecurityMetadataSource</strong><span class="md-plain">ä¸<span><strong>è‡ªå®šä¹‰accessDecisionManager</strong><span class="md-plain">é…ç½®åˆ°è‡ªå®šä¹‰FilterSecurityInterceptorçš„æ‹¦æˆªå™¨ä¸­</span></span></span></span></span></span></span></span></span></span></span></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span><strong>è‡ªå®šä¹‰SecurityMetadataSource</strong><span class="md-plain">ï¼Œå®ç°æ¥å£FilterInvocationSecurityMetadataSourceï¼Œå®ç°ä»æ•°æ®åº“æˆ–è€…å…¶ä»–æ•°æ®æºä¸­åŠ è½½ConfigAttributeï¼ˆå³æ˜¯ä»æ•°æ®åº“æˆ–è€…å…¶ä»–æ•°æ®æºä¸­åŠ è½½èµ„æºæƒé™ï¼‰</span></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span><strong>è‡ªå®šä¹‰accessDecisionManager</strong><span class="md-plain">ï¼Œå¯ä½¿ç”¨åŸºäºAccessDecisionVoterå®ç°æƒé™è®¤è¯çš„å®˜æ–¹UnanimousBased</span></span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span><strong>è‡ªå®šä¹‰AccessDecisionVoter</strong></span></p>
</li>
</ol>
<h3 class="md-end-block md-heading"><span class="md-plain">3.1 è‡ªå®šä¹‰MyFilterSecurityInterceptor</span></h3>
<p class="md-end-block md-p"><span><strong>è‡ªå®šä¹‰MyFilterSecurityInterceptor</strong><span class="md-plain">ä¸»è¦å·¥ä½œä¸ºï¼š</span></span></p>
<ul class="ul-list" data-mark="+">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">åŠ è½½è‡ªå®šä¹‰çš„SecurityMetadataSourceåˆ°è‡ªå®šä¹‰çš„FilterSecurityInterceptorä¸­ï¼›</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">åŠ è½½è‡ªå®šä¹‰çš„AccessDecisionManageråˆ°è‡ªå®šä¹‰çš„FilterSecurityInterceptorä¸­ï¼›</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">é‡å†™invokeæ–¹æ³•</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">@Component
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> MyFilterSecurityInterceptor <span style="color: #0000ff;">extends</span> AbstractSecurityInterceptor <span style="color: #0000ff;">implements</span><span style="color: #000000;"> Filter {
    </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> FilterInvocationSecurityMetadataSource securityMetadataSource;
 

    @Override
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> init(FilterConfig filterConfig) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> ServletException {
â€‹
    }
â€‹
    @Override
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> doFilter(ServletRequest request, ServletResponse response, FilterChain chain) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> IOException, ServletException {
        FilterInvocation fi </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> FilterInvocation(request, response, chain);
        invoke(fi);
    }
â€‹
    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span> invoke(FilterInvocation fi) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> IOException, ServletException {
        </span><span style="color: #008000;">//</span><span style="color: #008000;">fié‡Œé¢æœ‰ä¸€ä¸ªè¢«æ‹¦æˆªçš„url
        </span><span style="color: #008000;">//</span><span style="color: #008000;">é‡Œé¢è°ƒç”¨MyInvocationSecurityMetadataSourceçš„getAttributes(Object object)è¿™ä¸ªæ–¹æ³•è·å–fiå¯¹åº”çš„æ‰€æœ‰æƒé™
        </span><span style="color: #008000;">//</span><span style="color: #008000;">å†è°ƒç”¨MyAccessDecisionManagerçš„decideæ–¹æ³•æ¥æ ¡éªŒç”¨æˆ·çš„æƒé™æ˜¯å¦è¶³å¤Ÿ</span>
        InterceptorStatusToken token = <span style="color: #0000ff;">super</span><span style="color: #000000;">.beforeInvocation(fi);
        </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">æ‰§è¡Œä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨</span>
<span style="color: #000000;">            fi.getChain().doFilter(fi.getRequest(), fi.getResponse());
        } </span><span style="color: #0000ff;">finally</span><span style="color: #000000;"> {
            </span><span style="color: #0000ff;">super</span>.afterInvocation(token, <span style="color: #0000ff;">null</span><span style="color: #000000;">);
        }
    }
â€‹
    @Override
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> destroy() {
â€‹
    }
â€‹
    @Override
    </span><span style="color: #0000ff;">public</span> Class&lt;?&gt;<span style="color: #000000;"> getSecureObjectClass() {
        </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
    }
â€‹
    @Override
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> SecurityMetadataSource obtainSecurityMetadataSource() {
        </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.securityMetadataSource;
    }
â€‹
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> FilterInvocationSecurityMetadataSource getSecurityMetadataSource() {
        </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span><span style="color: #000000;">.securityMetadataSource;
    }
â€‹
    </span><span style="color: #008000;">//</span><span style="color: #008000;">è®¾ç½®è‡ªå®šä¹‰çš„FilterInvocationSecurityMetadataSource</span>
<span style="color: #000000;">    @Autowired
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setSecurityMetadataSource(MyFilterInvocationSecurityMetadataSource messageSource) {
        </span><span style="color: #0000ff;">this</span>.securityMetadataSource =<span style="color: #000000;"> messageSource;
    }
â€‹
    </span><span style="color: #008000;">//</span><span style="color: #008000;">è®¾ç½®è‡ªå®šä¹‰çš„AccessDecisionManager</span>
<span style="color: #000000;">    @Override
    @Autowired
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setAccessDecisionManager(AccessDecisionManager accessDecisionManager) {
        </span><span style="color: #0000ff;">super</span><span style="color: #000000;">.setAccessDecisionManager(accessDecisionManager);
    }
 }</span></pre>
</div>
</li>
</ul>
<h3 class="md-end-block md-heading"><span class="md-plain">3.2 è‡ªå®šä¹‰MyFilterInvocationSecurityMetadataSource </span></h3>
<p class="md-end-block md-p"><span><strong>è‡ªå®šä¹‰MyFilterInvocationSecurityMetadataSource</strong><span class="md-plain">ä¸»è¦å·¥ä½œä¸ºï¼š</span></span></p>
<ul class="ul-list" data-mark="+">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">ä»æ•°æ®æºä¸­åŠ è½½ConfigAttributeåˆ°SecurityMetadataSourceèµ„æºå™¨ä¸­</span></p>
</li>
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">é‡å†™getAttributes()åŠ è½½ConfigAttributeä¸ºAccessDecisionManager.decide()æˆæƒå†³ç­–åšå‡†å¤‡ã€‚</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">@Component
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> MyFilterInvocationSecurityMetadataSource <span style="color: #0000ff;">implements</span> FilterInvocationSecurityMetadataSource { <span style="color: #0000ff;">private</span> Map&lt;String, Collection&lt;ConfigAttribute&gt;&gt; configAttubuteMap = <span style="color: #0000ff;">null</span><span style="color: #000000;">;

   </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> loadResourceDefine() {
       </span><span style="color: #008000;">//</span><span style="color: #008000;">todo åŠ è½½æ•°æ®åº“çš„æ‰€æœ‰æƒé™</span>
        Collection&lt;ConfigAttribute&gt;<span style="color: #000000;"> attributes;
   }
   
   @Override
   </span><span style="color: #0000ff;">public</span> Collection&lt;ConfigAttribute&gt; getAttributes(Object object) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> IllegalArgumentException {
       AntPathRequestMatcher matcher;
       String resUrl;
       HttpServletRequest request </span>=<span style="color: #000000;"> ((FilterInvocation) object).getRequest();
       </span><span style="color: #008000;">//</span><span style="color: #008000;">1.åŠ è½½æƒé™èµ„æºæ•°æ®</span>
       <span style="color: #0000ff;">if</span> (configAttubuteMap == <span style="color: #0000ff;">null</span><span style="color: #000000;">) {
           loadResourceDefine();
       }
       Iterator</span>&lt;String&gt; iterator =<span style="color: #000000;"> configAttubuteMap.keySet().iterator();
       </span><span style="color: #0000ff;">while</span><span style="color: #000000;"> (iterator.hasNext()) {
           resUrl </span>=<span style="color: #000000;"> iterator.next();
           matcher </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> AntPathRequestMatcher(resUrl);
           </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (matcher.matches(request)) {
               </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> configAttubuteMap.get(resUrl);
           }
       }
       </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
       }
   
       @Override
       </span><span style="color: #0000ff;">public</span> Collection&lt;ConfigAttribute&gt;<span style="color: #000000;"> getAllConfigAttributes() {
           </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
       }
   
       @Override
       </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">boolean</span> supports(Class&lt;?&gt;<span style="color: #000000;"> clazz) {
           </span><span style="color: #0000ff;">return</span> FilterInvocation.<span style="color: #0000ff;">class</span><span style="color: #000000;">.isAssignableFrom(clazz);
       }
}</span></pre>
</div>
</li>
</ul>
<h3 class="md-end-block md-heading"><span class="md-plain">3.3 è‡ªå®šä¹‰MyAccessDecisionManager </span></h3>
<p class="md-end-block md-p"><span><strong>è‡ªå®šä¹‰MyAccessDecisionManager</strong><span class="md-plain">ä¸»è¦å·¥ä½œä¸ºï¼š</span></span></p>
<ul class="ul-list" data-mark="+">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">é‡å†™æœ€ç»ˆæˆæƒå†³ç­–decide()ï¼Œè‡ªå®šä¹‰æˆæƒè®¿é—®ç­–ç•¥</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">@Component
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> MyAccessDecisionManager <span style="color: #0000ff;">implements</span><span style="color: #000000;"> AccessDecisionManager {
   @Override
   </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> decide(Authentication authentication, Object object, Collection&lt;ConfigAttribute&gt; configAttributes) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> AccessDeniedException, InsufficientAuthenticationException {
       ConfigAttribute c;
       String needRole;
       </span><span style="color: #0000ff;">if</span>(<span style="color: #0000ff;">null</span>== configAttributes || configAttributes.size() &lt;=0<span style="color: #000000;">) {
           </span><span style="color: #0000ff;">return</span><span style="color: #000000;">;
       }
       </span><span style="color: #008000;">//</span><span style="color: #008000;">1.è·å–å·²å®šä¹‰çš„å¥½èµ„æºæƒé™é…ç½®</span>
       Iterator&lt;ConfigAttribute&gt; iterable=<span style="color: #000000;">configAttributes.iterator();
       </span><span style="color: #0000ff;">while</span><span style="color: #000000;"> (iterable.hasNext()){
           c</span>=<span style="color: #000000;">iterable.next();
           needRole</span>=<span style="color: #000000;">c.getAttribute();
           </span><span style="color: #008000;">//</span><span style="color: #008000;">2.ä¾æ¬¡æ¯”å¯¹ç”¨æˆ·è§’è‰²å¯¹åº”çš„èµ„æºæƒé™</span>
           <span style="color: #0000ff;">for</span><span style="color: #000000;"> (GrantedAuthority grantedAuthority:authentication.getAuthorities()){
               </span><span style="color: #0000ff;">if</span><span style="color: #000000;">(needRole.trim().equals(grantedAuthority.getAuthority())){
                   </span><span style="color: #0000ff;">return</span><span style="color: #000000;">;
               }
           }
       }
   
   }
   
   @Override
   </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> supports(ConfigAttribute attribute) {
       </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;
   }
   
   @Override
   </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">boolean</span> supports(Class&lt;?&gt;<span style="color: #000000;"> clazz) {
       </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;
   }
}</span></pre>
</div>
</li>
</ul>
<h3 class="md-end-block md-heading"><span class="md-plain">3.4 é…ç½®SecurityConfig</span></h3>
<p class="md-end-block md-p"><span><strong>é…ç½®SecurityConfig</strong><span class="md-plain">ä¸»è¦å·¥ä½œä¸ºï¼š</span></span></p>
<ul class="ul-list" data-mark="+">
<li class="md-list-item">
<p class="md-end-block md-p"><span class="md-plain">å°†FilterSecurityInterceptoræ‹¦æˆªå™¨åŠ è½½WebSecurityConfigä¸­</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span> configure(HttpSecurity http) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Exception {
   http.headers().frameOptions().disable().and()
       </span><span style="color: #008000;">//</span><span style="color: #008000;">è¡¨å•ç™»å½•</span>
<span style="color: #000000;">       .formLogin()
       .loginPage(SecurityConstants.APP_FORM_LOGIN_PAGE)
       .loginProcessingUrl(SecurityConstants.APP_FORM_LOGIN_URL)
       .successHandler(authenticationSuccessHandler())
       .failureHandler(authenticationFailureHandler())
       .and()
       </span><span style="color: #008000;">//</span><span style="color: #008000;">åº”ç”¨smsè®¤è¯é…ç½®</span>
<span style="color: #000000;">       .apply(smsAuthenticationSecurityConfig)
       .and()
       </span><span style="color: #008000;">//</span><span style="color: #008000;">å…è®¸é€šè¿‡</span>
<span style="color: #000000;">       .authorizeRequests()
       .antMatchers(SecurityConstants.APP_MOBILE_VERIFY_CODE_URL,
                    SecurityConstants.APP_USER_REGISTER_URL,
                   SecurityConstants.APP_FORM_LOGIN_INDEX_URL)
       .permitAll()</span><span style="color: #008000;">//</span><span style="color: #008000;">ä»¥ä¸Šçš„è¯·æ±‚éƒ½ä¸éœ€è¦è®¤è¯</span>
<span style="color: #000000;">       .and()
       </span><span style="color: #008000;">//</span><span style="color: #008000;">&ldquo;è®°ä½æˆ‘&rdquo;é…ç½®</span>
<span style="color: #000000;">       .rememberMe()
       .tokenRepository(jdbcTokenRepository())</span><span style="color: #008000;">//</span><span style="color: #008000;">tokenå…¥åº“å¤„ç†ç±»</span>
       .tokenValiditySeconds(SecurityConstants.REMEMBER_ME_VERIFY_TIME)<span style="color: #008000;">//</span><span style="color: #008000;">remember-meæœ‰æ•ˆæ—¶é—´è®¾ç½®</span>
       .rememberMeParameter(SecurityConstants.REMEMBER_ME_PARAM_NAME)<span style="color: #008000;">//</span><span style="color: #008000;">è¯·æ±‚å‚æ•°åè®¾ç½®</span>
<span style="color: #000000;">       .and()
       .csrf().disable();
    </span><span style="color: #008000;">//</span><span style="color: #008000;">å¢åŠ è‡ªå®šä¹‰æƒé™æˆæƒæ‹¦æˆªå™¨</span>
    http.addFilterBefore(myFilterSecurityInterceptor,FilterSecurityInterceptor.<span style="color: #0000ff;">class</span><span style="color: #000000;">);
}</span></pre>
</div>
<h2 class="md-end-block md-heading"><span class="md-plain">æ€»ç»“</span></h2>
<p class="md-end-block md-p"><span class="md-entity" data-content="&emsp;">&emsp;<span class="md-entity" data-content="&emsp;">&emsp;<span class="md-plain">Spring Securityæˆæƒè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä¼šæ¶‰ä¸»è¦æ¶‰åŠäº†ä¸Šé¢ä¸Šé¢æ‰€è¿°çš„ç»„ä»¶ï¼Œå…¶ä¸­ä¸»è¦çš„è¿˜æ˜¯è·Ÿç€æºç å¤šè·‘å‡ éï¼Œäº†è§£å…¶ä¸­çš„åŸç†ï¼Œæ‰èƒ½æ›´åŠ æµç•…çš„ç ä»£ç ã€‚åˆ°æ­¤ä¸ºæ­¢å†™å®ŒSpring Securityçš„è®¤è¯å’Œæˆæƒåˆ†ææµç¨‹ï¼Œæ¥ä¸‹æ¥ä¼šç»“åˆå‰é¢å°èŠ‚ï¼Œå†™ä¸€ä¸ªSpring securityå®Œç¾çš„æƒé™ç®¡ç†ç³»ç»Ÿã€‚</span></span></span></p>
<blockquote>
<p class="md-end-block md-p"><span class="md-plain">å„ä½çœ‹å®˜è¿˜å¯ä»¥å—ï¼Ÿå–œæ¬¢çš„è¯ï¼ŒåŠ¨åŠ¨æ‰‹æŒ‡ç‚¹ä¸ªèµğŸ’—ï¼Œç‚¹ä¸ªå…³æ³¨å‘—ï¼ï¼è°¢è°¢æ”¯æŒï¼</span></p>
<p class="md-end-block md-p"><span class="md-plain">ä¹Ÿæ¬¢è¿å…³æ³¨å…¬ä¼—å·ã€<strong>Ccwwç¬”è®°</strong><span class="md-plain">ã€‘ï¼ŒåŸåˆ›æŠ€æœ¯æ–‡ç« ç¬¬ä¸€æ—¶é—´æ¨å‡º</span></span></p>
</blockquote>
</li>
</ul>
<p><span class="md-plain"><span class="md-plain"><img style="display: block; margin-left: auto; margin-right: auto;" src="./images/[æƒé™ç®¡ç†ç³»ç»Ÿç¯‡] (äº”)-Spring securityï¼ˆæˆæƒè¿‡ç¨‹åˆ†æï¼‰2.png" alt="" /></span></span></p>

</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>