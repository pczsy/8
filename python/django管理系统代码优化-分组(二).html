<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修django管理系统代码优化-分组(二)' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>django管理系统代码优化-分组(二)</center></div><div class='banquan'>原文出处:本文由博客园博主小小咸鱼YwY提供。<br/>
原文连接:https://www.cnblogs.com/pythonywy/p/11346825.html</div><br>
    <h1 id="django管理系统代码优化-分组二">django管理系统代码优化-分组(二)</h1>
<p><code>后续进行代码更新,优化</code></p>
<h2 id="一优化的内容">一优化的内容</h2>
<p>优化前代码:https://www.cnblogs.com/pythonywy/p/11345626.html</p>
<ul>
<li>路由进行主次分组(<code>主要</code>)</li>
<li>cookies有效时间设置为1小时,1小时后失效</li>
<li>界面美化</li>
</ul>
<h2 id="二.创建app进行分组">二.创建app进行分组</h2>
<h3 id="app创建">1.app创建:</h3>
<ul>
<li>使用pycharm创建django的时候， 加上app的名字,多个app复制改名即可</li>
<li>命令行创建:Python manage.py startapp app的名字</li>
</ul>
<h3 id="创建后">2.创建后:</h3>
<p><img src="./images/django管理系统代码优化-分组(二)0.png" /></p>
<h3 id="app介绍">3.app介绍</h3>
<p><img src="./images/django管理系统代码优化-分组(二)1.png" /></p>
<h2 id="二.mysql表单创建">二.mysql表单创建</h2>
<p><code>zouye</code>库:存信息相关的</p>
<pre><code><code>#班级表
create table classes(
cid  int primary key auto_increment,
name varchar(32) not null default &#39;&#39;
)engine=Innodb charset=utf8;
insert into classes (name) values (&#39;三年A班&#39;), (&#39;三年B班&#39;),(&#39;三年C班&#39;);

#学生表
create table students (
sid int primary key auto_increment,
name varchar(32) not null default &#39;&#39;,
class_id int not null default 1,
foreign key (class_id) references classes(cid)
)engine=Innodb charset=utf8;
insert into students (name, class_id) values (&#39;张三&#39;, 1),(&#39;李四&#39;, 2),(&#39;王五&#39;, 1);

#老师表
create table teacher (
tid int primary key auto_increment,
name varchar(32) not null default &#39;&#39;
)engine=Innodb charset=utf8;
insert into teacher (name) values (&#39;老师1&#39;), (&#39;老师2&#39;),(&#39;老师3&#39;);

#关系表
create table teacher2class (
id int primary key auto_increment,
tid int not null default 1,
cid int not null default 1
)engine=Innodb charset=utf8;
insert into teacher2class (tid, cid) values (1,1), (1,2),(2,1),(2,2);</code></pre>
<p><code>userinfo</code>库:存账号密码</p>
<pre><code><code>create table info(id int,name char(30),password char(30)) charset utf8;</code></pre>
<h2 id="三.settings文件的设置">三.settings文件的设置</h2>
<p><code>setting.py</code></p>
<pre class="python"><code>&quot;&quot;&quot;
Django settings for djang分组 project.

Generated by &#39;django-admin startproject&#39; using Django 1.11.22.

For more information on this file, see
https://docs.djangoproject.com/en/1.11/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/1.11/ref/settings/
&quot;&quot;&quot;

import os

# Build paths inside the project like this: os.path.join(BASE_DIR, ...)
BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/1.11/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = &#39;_k@kzje+27*@f2!lgi60!s264fm&amp;a^!ev(g!!+)_eycn4pqv$5&#39;

# SECURITY WARNING: don&#39;t run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = []


# Application definition

INSTALLED_APPS = [
    &#39;django.contrib.admin&#39;,
    &#39;django.contrib.auth&#39;,
    &#39;django.contrib.contenttypes&#39;,
    &#39;django.contrib.sessions&#39;,
    &#39;django.contrib.messages&#39;,
    &#39;django.contrib.staticfiles&#39;,
    &#39;classes.apps.ClassesConfig&#39;,
]

MIDDLEWARE = [
    &#39;django.middleware.security.SecurityMiddleware&#39;,
    &#39;django.contrib.sessions.middleware.SessionMiddleware&#39;,
    &#39;django.middleware.common.CommonMiddleware&#39;,
    # &#39;django.middleware.csrf.CsrfViewMiddleware&#39;,
    &#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;,
    &#39;django.contrib.messages.middleware.MessageMiddleware&#39;,
    &#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;,
]

ROOT_URLCONF = &#39;djang分组.urls&#39;

TEMPLATES = [
    {
        &#39;BACKEND&#39;: &#39;django.template.backends.django.DjangoTemplates&#39;,
        &#39;DIRS&#39;: [os.path.join(BASE_DIR, &#39;templates&#39;)],
        &#39;APP_DIRS&#39;: True,
        &#39;OPTIONS&#39;: {
            &#39;context_processors&#39;: [
                &#39;django.template.context_processors.debug&#39;,
                &#39;django.template.context_processors.request&#39;,
                &#39;django.contrib.auth.context_processors.auth&#39;,
                &#39;django.contrib.messages.context_processors.messages&#39;,
            ],
        },
    },
]

WSGI_APPLICATION = &#39;djang分组.wsgi.application&#39;


# Database
# https://docs.djangoproject.com/en/1.11/ref/settings/#databases

DATABASES = {
    &#39;default&#39;: {
        &#39;ENGINE&#39;: &#39;django.db.backends.sqlite3&#39;,
        &#39;NAME&#39;: os.path.join(BASE_DIR, &#39;db.sqlite3&#39;),
    }
}


# Password validation
# https://docs.djangoproject.com/en/1.11/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        &#39;NAME&#39;: &#39;django.contrib.auth.password_validation.UserAttributeSimilarityValidator&#39;,
    },
    {
        &#39;NAME&#39;: &#39;django.contrib.auth.password_validation.MinimumLengthValidator&#39;,
    },
    {
        &#39;NAME&#39;: &#39;django.contrib.auth.password_validation.CommonPasswordValidator&#39;,
    },
    {
        &#39;NAME&#39;: &#39;django.contrib.auth.password_validation.NumericPasswordValidator&#39;,
    },
]


# Internationalization
# https://docs.djangoproject.com/en/1.11/topics/i18n/

LANGUAGE_CODE = &#39;en-us&#39;

TIME_ZONE = &#39;UTC&#39;

USE_I18N = True

USE_L10N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/1.11/howto/static-files/

STATIC_URL = &#39;/static/&#39;
STATICFILES_DIRS = (os.path.join(BASE_DIR, &#39;static&#39;),)</code></pre>
<h2 id="四.路由">四.路由</h2>
<h3 id="主路由django分组urls.py">主路由<code>django分组</code>&gt;<code>urls.py</code></h3>
<pre class="python"><code>import pymysql
from django.conf.urls import url,include
from django.shortcuts import render, redirect


def login(request):
    if request.method == &#39;GET&#39;:
        return render(request, &#39;login.html&#39;)
    cursor, conn = mysql_to_db(&#39;userinfo&#39;)
    user_name = request.POST.get(&#39;username&#39;)
    user_pwd = request.POST.get(&#39;pwd&#39;)
    sql = &#39;select * from info where name=%s and password=%s&#39;
    cursor.execute(sql, (user_name, user_pwd))
    a = cursor.fetchall()
    if a:
        obj = redirect(&#39;/classes/&#39;)
        obj.set_cookie(&#39;login&#39;, &#39;success&#39;,max_age=1800)
        return obj
    else:
        return render(request, &#39;login.html&#39;, {&#39;msg&#39;: &#39;登入失败&#39;})


def mysql_to_db(db):
    conn = pymysql.connect(
        host=&#39;127.0.0.1&#39;,
        port=3306,
        user=&#39;root&#39;,
        password=&#39;16745&#39;,
        db=db
    )
    cursor = conn.cursor(pymysql.cursors.DictCursor)
    return cursor, conn


def register(request):
    if request.method == &#39;GET&#39;:
        return render(request, &#39;register.html&#39;)
    cursor, conn = mysql_to_db(&#39;userinfo&#39;)
    user_name = request.POST.get(&#39;username&#39;)
    user_pwd = request.POST.get(&#39;pwd&#39;)
    print(user_name, user_pwd)
    sql = &#39;select name from info where name=%s&#39;
    x = cursor.execute(sql, (user_name))
    print(&#39;231&#39;)
    if not x:
        sql = &#39;insert into info(name,password) values(%s,%s) &#39;
        cursor.execute(sql, (user_name, user_pwd))
        a = cursor.fetchall()
        return render(request, &#39;register.html&#39;, {&#39;msg&#39;: &#39;注册成功&#39;})
    else:
        return render(request, &#39;register.html&#39;, {&#39;msg&#39;: &#39;登入失败&#39;})

def run(request):
    return render(request, &#39;run.html&#39;)



urlpatterns = [
    # url(r&#39;^admin/&#39;, admin.site.urls),
    url(r&#39;^login/&#39;, login),
    url(r&#39;^register/&#39;, register),
    url(r&#39;^teacher/&#39;, include(&#39;teacher.urls&#39;)),
    url(r&#39;^student/&#39;, include(&#39;student.urls&#39;)),
    url(r&#39;^classes/&#39;, include(&#39;classes.urls&#39;)),
    url(r&#39;&#39;, run),
]</code></pre>
<h3 id="分路由studenturls.py">分路由<code>student</code>&gt;<code>urls.py</code></h3>
<pre class="python"><code>from django.conf.urls import url
from django.contrib import admin
from student import views
urlpatterns = [
    url(r&#39;&#39;,views.student),
]</code></pre>
<h3 id="分路由teacherurls.py">分路由<code>teacher</code>&gt;<code>urls.py</code></h3>
<pre class="python"><code>from django.conf.urls import url
from django.contrib import admin
from teacher import views
urlpatterns = [
    url(r&#39;&#39;,views.teacher),
]</code></pre>
<p>分路由<code>classes</code>&gt;<code>urls.py</code></p>
<pre class="python"><code>from django.conf.urls import url
from django.contrib import admin
from classes import views
urlpatterns = [
    url(r&#39;^add/&#39;, views.add),
    url(r&#39;^up/&#39;, views.up),
    url(r&#39;^deleter/&#39;, views.show_class),
    url(r&#39;^ajax_add/&#39;, views.ajax_add),
    url(r&#39;^ajax_deleter/&#39;, views.ajax_deleter),
    url(r&#39;^ajax_up/&#39;, views.ajax_up),
    url(r&#39;^&#39;, views.show_class),
]
</code></pre>
<h2 id="五.html相关文件">五.html相关文件</h2>
<h3 id="母版">1.母版</h3>
<h4 id="fuck.html"><code>FUCK.html</code></h4>
<pre class="html"><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Title&lt;/title&gt;

    &lt;style&gt;

        a:hover {
            cursor: url(https://www.cnblogs.com/images/cnblogs_com/pythonywy/1516412/o_Hand.png), auto;
        }

        a:active {
            cursor: url(https://www.cnblogs.com/images/cnblogs_com/pythonywy/1516412/o_AppStarting.png), auto;
        }

        a:focus {
            cursor: url(https://www.cnblogs.com/images/cnblogs_com/pythonywy/1516412/o_wait.png), auto;
        }

        p, code {
            cursor: url(https://www.cnblogs.com/images/cnblogs_com/pythonywy/1516412/o_IBeam.png), auto;
        }

        * {
            cursor: url(https://www.cnblogs.com/images/cnblogs_com/pythonywy/1516412/o_Arrow.png), auto;
        }

        * {
            margin: 0;
            padding: 0;
        }

        .top {
            position: absolute;
            width: 100%;
            height: 100px;
            background: coral;
            background-size: 100% 100%;
        }

        .nav {
            position: absolute;
            left: 0;
            top: 100px;
            width: 200px;
            bottom: 0;
            background: chartreuse;
            text-align: center;
            overflow: auto;
            line-height: 30px;

        }

        a.class-action, a.student-action, .teacher-action {
            color: white;
            background: #80ff5d;
            padding: 10px;
            margin: 2px;
            display: block;
        }

        .data {
            position: absolute;
            left: 200px;
            top: 100px;
            bottom: 0;
            right: 0;
            background: url(&#39;https://images.cnblogs.com/cnblogs_com/pythonywy/1455150/o_111.png&#39;);
            background-size: 100% 100%;
            overflow: scroll;
        }

        .top-left {
            float: left;

            width: 200px;
            background: aqua;
            height: 100px;
            text-align: center;
            line-height: 100px;
            border-right: 2px solid white;
        }

        .top-right {
            float: right;
            text-align: center;
            line-height: 100px;
            margin-right: 50px;
        }
    &lt;/style&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css&quot;
          integrity=&quot;sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u&quot; crossorigin=&quot;anonymous&quot;&gt;
    &lt;style&gt;
        {% block css%}
        {% endblock %}

        th, td {
            padding: 10px;
        }
    &lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;div class=&quot;top&quot;&gt;
    &lt;div class=&quot;top-left&quot;&gt;管理系统&lt;/div&gt;
    &lt;div class=&quot;top-right&quot;&gt;
        &lt;a href=&quot;\login\&quot;&gt;登入&lt;/a&gt;
        &lt;a href=&quot;\register\&quot;&gt;注册&lt;/a&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;nav&quot;&gt;
    &lt;ol&gt;
        &lt;li&gt;&lt;a class=&quot;class-action&quot; href=&quot;\classes\&quot;&gt;班级系统&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a class=&quot;student-action&quot; href=&quot;\student\&quot;&gt;学生系统&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a class=&quot;teacher-action&quot; href=&quot;\teacher\&quot;&gt;老师系统&lt;/a&gt;&lt;/li&gt;
    &lt;/ol&gt;
&lt;/div&gt;
&lt;div class=&quot;data&quot;&gt;
    {% block data %}
    {% endblock %}
&lt;/div&gt;
&lt;/body&gt;
{% block js %}
{% endblock %}
&lt;/html&gt;</code></pre>
<h3 id="登入">2.登入</h3>
<h4 id="login.html"><code>login.html</code></h4>
<pre class="html"><code>{% extends &#39;FUCK.html&#39; %}
{% block data %}
    &lt;form action=&quot;/login/&quot; method=&quot;post&quot;  style=&quot;position: absolute;top: 20%;left: 40%&quot;&gt;
        账号: &lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;br&gt;
        密码: &lt;input type=&quot;password&quot; name=&quot;pwd&quot;&gt;&lt;br&gt;
        &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;
    &lt;/form&gt;
    &lt;a href=&quot;http://127.0.0.1:8000/register/&quot;&gt;去注册&lt;/a&gt;
    &lt;div style=&quot;color: red;font-size: 30px ;text-align: center&quot;&gt;{{ msg }}&lt;/div&gt;
{% endblock %}</code></pre>
<h3 id="注册">3.注册</h3>
<h4 id="register.html"><code>register.html</code></h4>
<pre class="python"><code>{% extends &#39;FUCK.html&#39; %}
{% block data %}
    &lt;form action=&quot;/register/&quot; method=&quot;post&quot;&gt;
    注册账号: &lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;br&gt;
    注册密码: &lt;input type=&quot;password&quot; name=&quot;pwd&quot;&gt;&lt;br&gt;
    &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;
&lt;/form&gt;
&lt;a href=&quot;http://127.0.0.1:8000/login/&quot;&gt;去登入&lt;/a&gt;
&lt;div&gt;{{msg}}&lt;/div&gt;
{% endblock %}</code></pre>
<h3 id="学生相关">4.学生相关</h3>
<h4 id="show_student.html"><code>show_student.html</code></h4>
<pre class="html"><code>{% extends &#39;FUCK.html&#39; %}
{% block css %}


    table {
    position: absolute;
    top: 28%;
    left: 0%;
    color: #000000;
    width: 100%;
    }
{% endblock %}}
{% block data %}

    &lt;table border=&quot;2px&quot;&gt;
        &lt;thead&gt;
        &lt;tr&gt;
            &lt;th&gt;学生ID&lt;/th&gt;
            &lt;th&gt;学生名字&lt;/th&gt;
            &lt;th&gt;班级名称&lt;/th&gt;
        &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
        {% for item in student %}
            &lt;tr&gt;
                &lt;td&gt;{{ item.sid }}&lt;/td&gt;
                &lt;td&gt;{{ item.sname }}&lt;/td&gt;
                &lt;td&gt;{{ item.cname }}&lt;/td&gt;
            &lt;/tr&gt;
        {% endfor %}
        &lt;/tbody&gt;
    &lt;/table&gt;
    &lt;form method=&quot;post&quot;&gt;
        &lt;input type=&quot;text&quot; style=&quot;visibility: hidden&quot; name=&quot;action&quot; value=&quot;add&quot;&gt;

        可选择班级&lt;select name=&quot;id&quot; id=&quot;&quot;&gt;
        {% for item in class %}
            &lt;option value=&quot;{{ item.cid }}&quot;&gt;{{ item.name }}&lt;/option&gt;
        {% endfor %}

    &lt;/select&gt;
        添加的学生名称&lt;input type=&quot;text&quot; name=&quot;name&quot;&gt;
        &lt;input type=&quot;submit&quot;&gt;
    &lt;/form&gt;
    &lt;div class=&quot;add-msg&quot;&gt;{{ addmsg }}&lt;/div&gt;


    &lt;form method=&quot;post&quot;&gt;
        &lt;input type=&quot;text&quot; style=&quot;visibility: hidden&quot; name=&quot;action&quot; value=&quot;up&quot;&gt;
        修改的学生&lt;select name=&quot;sid&quot; id=&quot;&quot;&gt;
        {% for item in student %}
            &lt;option value=&quot;{{ item.sid }}&quot;&gt;{{ item.sname }}&lt;/option&gt;
        {% endfor %}
    &lt;/select&gt;
        可选择班级&lt;select name=&quot;cid&quot; id=&quot;&quot;&gt;
        {% for item in class %}
            &lt;option value=&quot;{{ item.cid }}&quot;&gt;{{ item.name }}&lt;/option&gt;
        {% endfor %}
    &lt;/select&gt;
        输入修改的名字&lt;input type=&quot;text&quot; name=&quot;sname&quot;&gt;
        &lt;input type=&quot;submit&quot;&gt;
    &lt;/form&gt;
    &lt;div class=&quot;up-msg&quot;&gt;{{ upmsg }}&lt;/div&gt;


{% endblock %}
{% block js %}
{% endblock %}




</code></pre>
<h3 id="老师相关">5.老师相关</h3>
<h4 id="show_teacher.html"><code>show_teacher.html</code></h4>
<pre class="python"><code>{% extends &#39;FUCK.html&#39; %}
{% block data %}

    &lt;table border=&quot;2px&quot; class=&quot;table table-bordered&quot;&gt;
        &lt;thead&gt;
        &lt;tr&gt;
            &lt;th&gt;id&lt;/th&gt;
            &lt;th&gt;老师名称&lt;/th&gt;
            &lt;th&gt;班级&lt;/th&gt;

        &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
        {% for item in info %}
            &lt;tr&gt;
                &lt;td&gt;{{ item.tid }}&lt;/td&gt;
                &lt;td&gt;{{ item.name }}&lt;/td&gt;
                &lt;td&gt;{{ item.cname }}&lt;/td&gt;

            &lt;/tr&gt;
        {% endfor %}
        &lt;/tbody&gt;
    &lt;/table&gt;
    &lt;div&gt;{{ msg }}&lt;/div&gt;

    &lt;form class=&quot;action&quot; method=&quot;post&quot;&gt;
        &lt;input type=&quot;text&quot; name=&quot;action&quot; value=&quot;add&quot; style=&quot;display: none&quot;&gt;
        已有老师教添加班级&lt;select name=&quot;tid&quot; id=&quot;&quot;&gt;
        {% for foo in teacher_info %}
            &lt;option value=&quot;{{ foo.tid }}&quot;&gt;{{ foo.name }}&lt;/option&gt;
        {% endfor %}
    &lt;/select&gt;
        &lt;select name=&quot;cid&quot; id=&quot;&quot;&gt;
            {% for class in class_info %}
                &lt;option value=&quot;{{ class.cid }}&quot;&gt;{{ class.name }}&lt;/option&gt;
            {% endfor %}
        &lt;/select&gt;
        &lt;input type=&quot;submit&quot;&gt;
    &lt;/form&gt;


    &lt;form class=&quot;action&quot; method=&quot;post&quot;&gt;
        &lt;input type=&quot;text&quot; name=&quot;action&quot; value=&quot;delete&quot; style=&quot;display: none&quot;&gt;
        已有老师教删除班级&lt;select name=&quot;tid&quot; id=&quot;&quot;&gt;
        {% for foo in teacher_info %}
            &lt;option value=&quot;{{ foo.tid }}&quot;&gt;{{ foo.name }}&lt;/option&gt;
        {% endfor %}
    &lt;/select&gt;
        &lt;/select&gt;
        &lt;select name=&quot;cid&quot; id=&quot;&quot;&gt;
            {% for class in class_info %}
                &lt;option value=&quot;{{ class.cid }}&quot;&gt;{{ class.name }}&lt;/option&gt;
            {% endfor %}
        &lt;/select&gt;
        &lt;input type=&quot;submit&quot;&gt;
    &lt;/form&gt;
    &lt;span style=&quot;color: red&quot;&gt; {{ delete_msg }} &lt;/span&gt;

{% endblock %}
{% block js %}
    &lt;script
            src=&quot;http://code.jquery.com/jquery-1.12.4.min.js&quot;
            integrity=&quot;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&quot;
            crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
        $(&#39;.add-button&#39;).click(function () {
            $(&#39;#add-back,#add-window&#39;).css(&#39;display&#39;, &#39;block&#39;);
        });

        $(&#39;.add-window-button&#39;).click(function () {
            $(&#39;#add-back,#add-window&#39;).css(&#39;display&#39;, &#39;none&#39;);
        });

        $(&#39;.add-submit&#39;).click(function () {
            var name = $(&#39;.add-text&#39;).val();

            $.ajax({
                type: &quot;POST&quot;,
                url: &quot;/ajax_add/&quot;,
                data: {&#39;classname&#39;: name},
                success: function (msg) {
                    if (msg == &#39;OK&#39;) {
                        alert(&#39;添加成功&#39;);
                        window.location.href = &#39;/class/&#39;;
                    } else {
                        alert(&#39;输入内容不能为空&#39;);
                        {#window.location.replace(location.href);#}
                    }

                }
            });
        });


        $(&#39;.up-button&#39;).click(function () {
            $(&#39;#up-back,#up-window&#39;).css(&#39;display&#39;, &#39;block&#39;);
            window.upid = $(this).attr(&#39;cid&#39;);
            $(&#39;.up-text&#39;).val($(this).attr(&#39;classname&#39;));
            console.log(upid);

        });

        $(&#39;.up-window-button&#39;).click(function () {
            $(&#39;#up-back,#up-window&#39;).css(&#39;display&#39;, &#39;none&#39;);
        });

        $(&#39;.up-submit&#39;).click(function () {
            var name = $(&#39;.up-text&#39;).val();
            console.log(name);
            console.log(upid);
            $.ajax({
                type: &quot;POST&quot;,
                url: &quot;/ajax_up/&quot;,
                data: {&#39;id&#39;: upid, &#39;name&#39;: name},
                success: function (msg) {
                    if (msg == &#39;OK&#39;) {
                        alert(&#39;更新成功&#39;);
                        window.location.href = &#39;/class/&#39;;
                    } else {
                        alert(&#39;输入内容不能为空&#39;);
                    }

                }
            });
        });


        $(&#39;.deleter-button&#39;).click(function () {
            var chiose = confirm(&#39;是否删除&#39;);
            var deleter_id = $(this).attr(&#39;cid&#39;);
            if (chiose) {
                $.ajax({
                    type: &quot;POST&quot;,
                    url: &quot;/ajax_deleter/&quot;,
                    data: {&#39;id&#39;: deleter_id},
                    success: function (msg) {
                        if (msg == &#39;OK&#39;) {
                            alert(&#39;删除成功&#39;);
                            window.location.href = &#39;/class/&#39;;
                        } else {
                            alert(&#39;内容有关联无法删除&#39;);
                        }

                    }
                });
            }
        });


        $(&#39;.deleter-a&#39;).click(function () {
            var chiose = confirm(&#39;是否删除&#39;);
            return chiose
        })
    &lt;/script&gt;
{% endblock %}
</code></pre>
<h3 id="班级相关">6.班级相关</h3>
<h4 id="show_class.html"><code>show_class.html</code></h4>
<pre class="python"><code>{% extends &#39;FUCK.html&#39; %}
{% block css %}


    table{
    position: absolute;
    top: 0;
    left: 0;
    color: #000000;
    width: 100%;
    }

    #up-back, #add-back {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    }

    #up-window, #add-window {
    position: fixed;
    top: 20%;
    left: 37%;
    width: 400px;
    height: 200px;
    background-color: beige;
    text-align: center;
    display: none;
    }

{% endblock %}}
{% block data %}

    &lt;table border=&quot;2px&quot; class=&quot;table-hover&quot;&gt;
        &lt;thead&gt;
        &lt;tr&gt;
            &lt;th&gt;id&lt;/th&gt;
            &lt;th&gt;班级名称&lt;/th&gt;
            &lt;th colspan=&quot;3&quot;&gt;功能&lt;/th&gt;
            &lt;th colspan=&quot;3&quot;&gt;ajax功能&lt;/th&gt;
        &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
        {% for item in dict_list %}
            &lt;tr&gt;
                &lt;td&gt;{{ item.cid }}&lt;/td&gt;
                &lt;td&gt;{{ item.name }}&lt;/td&gt;
                &lt;td&gt;&lt;a class=&#39;deleter-a glyphicon glyphicon-trash&#39; href=&quot;/classes/?id={{ item.cid }}&quot;&gt;&lt;/a&gt;&lt;/td&gt;
                &lt;td&gt;&lt;a href=&quot;/classes/up/?id={{ item.cid }}&amp;name={{ item.name }}&quot;&gt;更新&lt;/a&gt;&lt;/td&gt;
                &lt;td&gt;&lt;a href=&quot;/classes/add/&quot;&gt;添加&lt;/a&gt;&lt;/td&gt;
                &lt;td&gt;
                    &lt;button class=&#39;deleter-button glyphicon glyphicon-trash&#39;
                            cid={{ item.cid }} classname={{ item.name }}&gt;&lt;/button&gt;
                &lt;/td&gt;
                &lt;td&gt;
                    &lt;button class=&#39;up-button&#39; cid={{ item.cid }} classname={{ item.name }}&gt;更新&lt;/button&gt;
                &lt;/td&gt;
                &lt;td&gt;
                    &lt;button class=&#39;add-button&#39; cid={{ item.cid }} classname={{ item.name }}&gt;添加&lt;/button&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
        {% endfor %}
        &lt;/tbody&gt;
    &lt;/table&gt;
    &lt;div&gt;{{ msg }}&lt;/div&gt;

    &lt;div id=&quot;up-back&quot;&gt;&lt;/div&gt;
    &lt;div id=&quot;up-window&quot;&gt;
        &lt;input type=&quot;text&quot; name=&quot;id&quot; style=&quot;visibility: hidden&quot;&gt;&lt;br&gt;
        修改名称:&lt;input type=&quot;text&quot; class=&#39;up-text&#39; name=&quot;&#39;classname&quot;&gt;
        &lt;input class=&#39;up-submit&#39; type=&quot;button&quot; value=&quot;提交&quot;&gt;
        &lt;button class=&quot;up-window-button&quot;&gt;取消&lt;/button&gt;
    &lt;/div&gt;
    &lt;div id=&quot;add-back&quot;&gt;&lt;/div&gt;
    &lt;div id=&quot;add-window&quot;&gt;
        &lt;input type=&quot;text&quot; name=&quot;id&quot; style=&quot;visibility: hidden&quot;&gt;&lt;br&gt;
        添加名称:&lt;input type=&quot;text&quot; class=&#39;add-text&#39; name=&quot;&#39;classname&quot;&gt;
        {#    &lt;button class=&quot;add-submit&quot;&gt;提交&lt;/button&gt;#}
        &lt;input class=&#39;add-submit&#39; type=&quot;button&quot; value=&quot;提交&quot;&gt;
        &lt;button class=&quot;add-window-button&quot;&gt;取消&lt;/button&gt;
    &lt;/div&gt;


{% endblock %}
{% block js %}
    &lt;script
            src=&quot;http://code.jquery.com/jquery-1.12.4.min.js&quot;
            integrity=&quot;sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=&quot;
            crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
        $(&#39;.add-button&#39;).click(function () {
            $(&#39;#add-back,#add-window&#39;).css(&#39;display&#39;, &#39;block&#39;);
        });

        $(&#39;.add-window-button&#39;).click(function () {
            $(&#39;#add-back,#add-window&#39;).css(&#39;display&#39;, &#39;none&#39;);
        });

        $(&#39;.add-submit&#39;).click(function () {
            var name = $(&#39;.add-text&#39;).val();

            $.ajax({
                type: &quot;POST&quot;,
                url: &quot;/classes/ajax_add/&quot;,
                data: {&#39;classname&#39;: name},
                success: function (msg) {
                    if (msg == &#39;OK&#39;) {
                        alert(&#39;添加成功&#39;);
                        window.location.href = &#39;/classes/&#39;;
                    } else {
                        alert(&#39;输入内容不能为空&#39;);
                        {#window.location.replace(location.href);#}
                    }

                }
            });
        });


        $(&#39;.up-button&#39;).click(function () {
            $(&#39;#up-back,#up-window&#39;).css(&#39;display&#39;, &#39;block&#39;);
            window.upid = $(this).attr(&#39;cid&#39;);
            $(&#39;.up-text&#39;).val($(this).attr(&#39;classname&#39;));
            console.log(upid);

        });

        $(&#39;.up-window-button&#39;).click(function () {
            $(&#39;#up-back,#up-window&#39;).css(&#39;display&#39;, &#39;none&#39;);
        });

        $(&#39;.up-submit&#39;).click(function () {
            var name = $(&#39;.up-text&#39;).val();
            console.log(name);
            console.log(upid);
            $.ajax({
                type: &quot;POST&quot;,
                url: &quot;/classes/ajax_up/&quot;,
                data: {&#39;id&#39;: upid, &#39;name&#39;: name},
                success: function (msg) {
                    if (msg == &#39;OK&#39;) {
                        alert(&#39;更新成功&#39;);
                        window.location.href = &#39;/classes/&#39;;
                    } else {
                        alert(&#39;输入内容不能为空&#39;);
                    }

                }
            });
        });


        $(&#39;.deleter-button&#39;).click(function () {
            var chiose = confirm(&#39;是否删除&#39;);
            var deleter_id = $(this).attr(&#39;cid&#39;);
            if (chiose) {
                $.ajax({
                    type: &quot;POST&quot;,
                    url: &quot;/classes/ajax_deleter/&quot;,
                    data: {&#39;id&#39;: deleter_id},
                    success: function (msg) {
                        if (msg == &#39;OK&#39;) {
                            alert(&#39;删除成功&#39;);
                            window.location.href = &#39;/classes/&#39;;
                        } else {
                            alert(&#39;内容有关联无法删除&#39;);
                        }

                    }
                });
            }
        });


        $(&#39;.deleter-a&#39;).click(function () {
            var chiose = confirm(&#39;是否删除&#39;);
            return chiose
        })
    &lt;/script&gt;
{% endblock %}</code></pre>
<h4 id="add.html"><code>add.html</code></h4>
<pre class="html"><code>{% extends &#39;FUCK.html&#39; %}
{% block data %}
    &lt;form action=&quot;&quot; method=&quot;post&quot;&gt;
        添加班级名称:&lt;input type=&quot;text&quot; name=&quot;classname&quot;&gt;
        &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;
        &lt;div&gt;{{ msg }}&lt;/div&gt;
    &lt;/form&gt;
{% endblock %}</code></pre>
<h4 id="up.html"><code>up.html</code></h4>
<pre class="html"><code>{% extends &#39;FUCK.html&#39; %}
{% block data %}
    &lt;form action=&quot;&quot; method=&quot;post&quot;&gt;
    跟换班级名称:&lt;input type=&quot;text&quot; name=&quot;classname&quot; placeholder=&quot;{{test}}&quot;&gt;
    &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;
    &lt;div&gt;{{msg}}&lt;/div&gt;
&lt;/form&gt;
{% endblock %}</code></pre>
<h3 id="首页">7.首页</h3>
<p>run.html</p>
<pre class="html"><code>{% extends &#39;FUCK.html&#39; %}
{% block data %}
&lt;div style=&quot;color: red;font-size: 40px;text-align: center;&quot;&gt;欢迎来到管理系统&lt;/div&gt;
{% endblock %}</code></pre>
<h2 id="六.视图">六.视图</h2>
<h3 id="学生端">学生端</h3>
<p><code>student</code>&gt;<code>view.py</code></p>
<pre class="python"><code>import pymysql
from django.shortcuts import render, redirect


# Create your views here.


def login_deco(func):
    def wrapper(request):
        print(request.COOKIES)
        if request.COOKIES:
            res = func(request)
            return res
        else:
            return render(request, &#39;login.html&#39;, {&#39;msg&#39;: &#39;登入失效请重新登入&#39;})

    return wrapper


def mysql_to_db(db):
    conn = pymysql.connect(
        host=&#39;127.0.0.1&#39;,
        port=3306,
        user=&#39;root&#39;,
        password=&#39;16745&#39;,
        db=db
    )
    cursor = conn.cursor(pymysql.cursors.DictCursor)
    return cursor, conn


@login_deco
def student(request):
    cursor, conn = mysql_to_db(&#39;zuoye&#39;)
    if request.method == &#39;GET&#39;:
        sql_1 = &#39;SELECT sid,students.name as sname,cid,classes.name as cname from students,classes where class_id=cid&#39;
        sql_2 = &#39;SELECT * from classes&#39;
        cursor.execute(sql_1)
        student_info = cursor.fetchall()
        cursor.execute(sql_2)
        class_info = cursor.fetchall()
        return render(request, &#39;show_student.html&#39;, {&#39;student&#39;: student_info, &#39;class&#39;: class_info})
    else:
        if request.POST.get(&#39;action&#39;) == &#39;add&#39;:
            sql_1 = &#39;SELECT sid,students.name as sname,cid,classes.name as cname from students,classes where class_id=cid&#39;
            sql_2 = &#39;SELECT * from classes&#39;
            cursor.execute(sql_1)
            student_info = cursor.fetchall()
            cursor.execute(sql_2)
            class_info = cursor.fetchall()
            print(request.POST)
            name = request.POST.get(&#39;name&#39;)
            id = request.POST.get(&#39;id&#39;)
            print(name, id)
            if name:
                sql = &#39;insert into students(name,class_id) values(%s,%s)&#39;
                cursor.execute(sql, (name, id))
                conn.commit()
                return redirect(&#39;/student/&#39;)
            else:
                return render(request, &#39;show_student.html&#39;,
                              {&#39;student&#39;: student_info, &#39;class&#39;: class_info, &#39;addmsg&#39;: &#39;名字不能为空&#39;})
        elif request.POST.get(&#39;action&#39;) == &#39;up&#39;:
            print(request.POST)
            sql_1 = &#39;SELECT sid,students.name as sname,cid,classes.name as cname from students,classes where class_id=cid&#39;
            sql_2 = &#39;SELECT * from classes&#39;
            cursor.execute(sql_1)
            student_info = cursor.fetchall()
            cursor.execute(sql_2)
            class_info = cursor.fetchall()
            print(request.POST)
            name = request.POST.get(&#39;sname&#39;)
            sid = request.POST.get(&#39;sid&#39;)
            cid = request.POST.get(&#39;cid&#39;)
            print(name, sid, cid)
            if name:
                sql = &#39;update students set name=%s,class_id=%s where sid=%s&#39;
                cursor.execute(sql, (name, cid, sid))
                conn.commit()
                return redirect(&#39;/student/&#39;)
            else:
                return render(request, &#39;show_student.html&#39;,
                              {&#39;student&#39;: student_info, &#39;class&#39;: class_info, &#39;upmsg&#39;: &#39;名字不能为空&#39;})
</code></pre>
<h3 id="老师端">老师端</h3>
<p><code>teacher</code>&gt;<code>view.py</code></p>
<pre class="python"><code>import pymysql
from django.shortcuts import render, redirect


# Create your views here.


def login_deco(func):
    def wrapper(request):
        print(request.COOKIES)
        if request.COOKIES:
            res = func(request)
            return res
        else:
            return render(request, &#39;login.html&#39;, {&#39;msg&#39;: &#39;登入失效请重新登入&#39;})

    return wrapper


def mysql_to_db(db):
    conn = pymysql.connect(
        host=&#39;127.0.0.1&#39;,
        port=3306,
        user=&#39;root&#39;,
        password=&#39;16745&#39;,
        db=db
    )
    cursor = conn.cursor(pymysql.cursors.DictCursor)
    return cursor, conn


@login_deco
def teacher(request):
    cursor, conn = mysql_to_db(&#39;zuoye&#39;)
    if request.method == &#39;GET&#39;:
        sql = &#39;SELECT teacher.tid,teacher.name,GROUP_CONCAT(classes.name) as cname FROM teacher left JOIN teacher2class ON teacher.tid=teacher2class.tid LEFT JOIN classes ON classes.cid=teacher2class.cid GROUP BY teacher.tid&#39;
        cursor.execute(sql)
        info = cursor.fetchall()
        sq1_teacher = &#39;select * from teacher&#39;
        cursor.execute(sq1_teacher)
        teacher_info = cursor.fetchall()
        sq1_teacher = &#39;select * from classes&#39;
        cursor.execute(sq1_teacher)
        class_info = cursor.fetchall()
        print(info)
        print(teacher_info)
        print(class_info)
        obj = render(request, &#39;show_teacher.html&#39;,
                     {&#39;info&#39;: info, &#39;class_info&#39;: class_info, &#39;teacher_info&#39;: teacher_info})
        return obj
    else:
        if request.POST.get(&#39;action&#39;) == &#39;add&#39;:
            tid = request.POST.get(&#39;tid&#39;)
            cid = request.POST.get(&#39;cid&#39;)
            sql = &#39;insert into teacher2class(cid,tid) values(%s,%s)&#39;
            cursor.execute(sql, (cid, tid))
            conn.commit()
            obj = redirect(&#39;/teacher/&#39;)
            return obj
        if request.POST.get(&#39;action&#39;) == &#39;delete&#39;:

            tid = request.POST.get(&#39;tid&#39;)
            cid = request.POST.get(&#39;cid&#39;)
            sql = &#39;delete from teacher2class where cid=%s and tid=%s&#39;
            a = cursor.execute(sql, (cid, tid))
            conn.commit()
            if a:
                obj = redirect(&#39;/teacher/&#39;)
                return obj
            else:
                sql = &#39;SELECT teacher.tid,teacher.name,GROUP_CONCAT(classes.name) as cname FROM teacher left JOIN teacher2class ON teacher.tid=teacher2class.tid LEFT JOIN classes ON classes.cid=teacher2class.cid GROUP BY teacher.tid&#39;
                cursor.execute(sql)
                info = cursor.fetchall()
                sq1_teacher = &#39;select * from teacher&#39;
                cursor.execute(sq1_teacher)
                teacher_info = cursor.fetchall()
                sq1_teacher = &#39;select * from classes&#39;
                cursor.execute(sq1_teacher)
                class_info = cursor.fetchall()
                obj = render(request, &#39;show_teacher.html&#39;,
                             {&#39;info&#39;: info, &#39;class_info&#39;: class_info, &#39;teacher_info&#39;: teacher_info,
                              &#39;delete_msg&#39;: &#39;该老师没有教这个班级&#39;})
                return obj</code></pre>
<h3 id="班级端">班级端</h3>
<pre class="python"><code>import pymysql
from django.shortcuts import HttpResponse, render, redirect


# Create your views here.


def login_deco(func):
    def wrapper(request):
        print(request.COOKIES)
        if request.COOKIES:
            res = func(request)
            return res
        else:
            return render(request, &#39;login.html&#39;, {&#39;msg&#39;: &#39;登入失效请重新登入&#39;})

    return wrapper


def mysql_to_db(db):
    conn = pymysql.connect(
        host=&#39;127.0.0.1&#39;,
        port=3306,
        user=&#39;root&#39;,
        password=&#39;16745&#39;,
        db=db
    )
    cursor = conn.cursor(pymysql.cursors.DictCursor)
    return cursor, conn


@login_deco
def show_class(request):
    if request.method == &#39;GET&#39;:
        cursor, conn = mysql_to_db(&#39;zuoye&#39;)
        if not request.GET:
            sql = &#39;select * from classes&#39;
            cursor.execute(sql)
            info = cursor.fetchall()
            print(info)
            return render(request, &#39;show_class.html&#39;, {&#39;dict_list&#39;: info})
        else:
            deleter_id = request.GET.get(&#39;id&#39;)

            sql = &#39;delete from classes where cid=%s &#39;
            try:
                a = cursor.execute(sql, (deleter_id,))
                conn.commit()
                obj = redirect(&#39;/classes/&#39;)
                return obj
            except:
                sql = &#39;select * from classes&#39;
                cursor.execute(sql)
                info = cursor.fetchall()
                obj = render(request, &#39;show_class.html&#39;, {&#39;dict_list&#39;: info, &#39;msg&#39;: &#39;内容有关联无法删除 &#39;})
                return obj


def add(request):
    if request.method == &#39;GET&#39;:
        return render(request, &#39;add.html&#39;)
    else:
        if not request.POST.get(&#39;classname&#39;):
            return render(request, &#39;add.html&#39;, {&#39;msg&#39;: &#39;输入内容不能为空&#39;})
        else:
            classname = request.POST.get(&#39;classname&#39;)
            print(classname)
            cursor, conn = mysql_to_db(&#39;zuoye&#39;)
            sql = &#39;insert into classes(name) values(%s)&#39;
            cursor.execute(sql, (classname,))
            conn.commit()
            return redirect(&#39;/classes/&#39;)


def up(request):
    id = request.GET.get(&#39;id&#39;)
    name = request.GET.get(&#39;name&#39;)
    print(id)
    print(name)
    if request.method == &#39;GET&#39;:
        return render(request, &#39;add.html&#39;, {&#39;name&#39;: name})
    else:
        if not request.POST.get(&#39;classname&#39;):
            return render(request, &#39;add.html&#39;, {&#39;msg&#39;: &#39;输入内容不能为空&#39;})
        else:
            classname = request.POST.get(&#39;classname&#39;)
            print(classname)
            cursor, conn = mysql_to_db(&#39;zuoye&#39;)
            sql = &#39;update classes set name=%s where cid = %s&#39;
            cursor.execute(sql, (classname, id))
            conn.commit()
            return redirect(&#39;/classes/&#39;)


def ajax_add(request):
    class_name = request.POST.get(&#39;classname&#39;)
    if class_name:
        cursor, conn = mysql_to_db(&#39;zuoye&#39;)
        sql = &#39;insert into classes(name) values(%s)&#39;
        cursor.execute(sql, (class_name,))
        conn.commit()
        return HttpResponse(&#39;OK&#39;)
    else:
        return HttpResponse(&#39;不能为空&#39;)


def ajax_up(request):
    print(request.POST)
    class_name = request.POST.get(&#39;name&#39;)
    id = request.POST.get(&#39;id&#39;)
    # print(class_name,id)
    if class_name:
        cursor, conn = mysql_to_db(&#39;zuoye&#39;)
        sql = &#39;update classes set name=%s where cid = %s&#39;
        cursor.execute(sql, (class_name, id))
        conn.commit()
        return HttpResponse(&#39;OK&#39;)
    else:
        return HttpResponse(&#39;不能为空&#39;)


def ajax_deleter(request):
    id = request.POST.get(&#39;id&#39;)
    try:
        cursor, conn = mysql_to_db(&#39;zuoye&#39;)
        sql = &#39;delete from classes where cid=%s &#39;
        cursor.execute(sql, (id,))
        conn.commit()
        return HttpResponse(&#39;OK&#39;)
    except:
        return HttpResponse(&#39;11&#39;)</code></pre>

</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>